<?php get_header(); ?>
  <div id="Top"></div>

  <main id="page-home-main" role="main" aria-label="Content">
    <?php if (have_posts()): while (have_posts()) : the_post(); ?>

      <?php
        $blocks = parse_blocks( get_the_content() );
        $content_blocks = array_filter($blocks, function($block) {
          return $block['blockName'] !== 'core/gallery';
        });
        $gallery_block = array_filter($blocks, function($block) {
          return $block['blockName'] === 'core/gallery';
        });
        $random_image_url = '';
        foreach ( $gallery_block as $gallery ) {
          $number_of_images = sizeof($gallery['attrs']['ids']);
          $random_image_index = rand(0, $number_of_images - 1);
          $random_image_id = $gallery['attrs']['ids'][$random_image_index];
          $random_image_url = wp_get_attachment_image_src( $random_image_id, 'large' )[0];
        }
      ?>

      <section id="home-splash">
        <svg width="1191px" height="623px" viewBox="0 0 1191 623" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g id="future-health-splash-page" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
            <g id="future-health-splash" transform="translate(-193.000000, -251.000000)">
              <g id="future-health-splash-artboard" transform="translate(193.200000, 251.200000)">
                <pattern id="svg-pattern" width="100%" height="100%">
                  <image width="100%" height="100%" xlink:href="<?php echo $random_image_url; ?>" preserveAspectRatio="xMinYMin slice"></image>
                </pattern>
                <path style="fill:url(#svg-pattern)" d="M3.69482223e-13,300.8 L3.69482223e-13,0 L207.2,0 L207.2,59.6 L60,59.6 L60,116.4 L188,116.4 L188,176 L60,176 L60,300.8 L3.69482223e-13,300.8 Z M305.866666,305.6 C256.266666,305.6 223.466666,270 223.466666,212.4 L223.466666,85.2 L283.466666,85.2 L283.466666,201.6 C283.466666,228.8 298.666666,244.4 319.866666,244.4 C337.866666,244.4 359.866666,233.2 369.866666,201.2 L369.866666,85.2 L430.266666,85.2 L430.266666,300.8 L369.866666,300.8 L369.866666,277.6 C351.466666,295.6 331.866666,305.6 305.866666,305.6 Z M566.133332,305.6 C510.933332,305.6 488.133332,283.6 488.133332,229.2 L488.133332,143.6 L452.933332,143.6 L452.933332,84.8 L488.133332,84.8 L488.133332,24.4 L548.133332,24.4 L548.133332,84.8 L590.933332,84.8 L590.933332,143.6 L548.133332,143.6 L548.133332,212 C548.133332,240 556.133332,245.6 567.733332,245.6 L592.933332,245.6 L592.933332,304 C584.933332,304.8 576.533332,305.6 566.133332,305.6 Z M698.399998,305.6 C648.799998,305.6 615.999998,270 615.999998,212.4 L615.999998,85.2 L675.999998,85.2 L675.999998,201.6 C675.999998,228.8 691.199998,244.4 712.399998,244.4 C730.399998,244.4 752.399998,233.2 762.399998,201.2 L762.399998,85.2 L822.799998,85.2 L822.799998,300.8 L762.399998,300.8 L762.399998,277.6 C743.999998,295.6 724.399998,305.6 698.399998,305.6 Z M853.866664,300.8 L853.866664,84.8 L913.866664,84.8 L913.866664,114.8 C931.066664,91.6 953.866664,81.6 985.866664,83.2 L985.866664,152.4 C936.666664,152.4 913.866664,172.8 913.866664,216.4 L913.866664,300.8 L853.866664,300.8 Z M1095.33333,305.6 C1030.93333,305.6 988.53333,260.8 988.53333,192.8 C988.53333,126 1030.13333,81.2 1091.33333,81.2 C1152.53333,81.2 1190.53333,126.4 1190.53333,198.8 L1190.53333,216 L1049.73333,216 C1056.53333,235.6 1072.93333,246.4 1095.73333,246.4 C1115.33333,246.4 1132.13333,238.4 1141.73333,224.4 L1187.73333,255.2 C1163.73333,289.6 1134.13333,305.6 1095.33333,305.6 Z M1052.13333,168.4 L1128.13333,168.4 C1126.13333,151.6 1111.33333,140 1092.13333,140 C1073.33333,140 1057.33333,151.2 1052.13333,168.4 Z M1190.8,320.2 L1190.8,621 L1130.8,621 L1130.8,503.4 L1014.8,503.4 L1014.8,621 L954.8,621 L954.8,320.2 L1014.8,320.2 L1014.8,444.2 L1130.8,444.2 L1130.8,320.2 L1190.8,320.2 Z M823,315.4 C887.4,315.4 929.8,360.2 929.8,428.2 C929.8,495 888.2,539.8 827,539.8 C765.8,539.8 727.8,494.6 727.8,422.2 L727.8,405 L868.6,405 C861.8,385.4 845.4,374.6 822.6,374.6 C803,374.6 786.2,382.6 776.6,396.6 L730.6,365.8 C754.6,331.4 784.2,315.4 823,315.4 Z M866.2,452.6 L790.2,452.6 C792.2,469.4 807,481 826.2,481 C845,481 861,469.8 866.2,452.6 Z M630.2,315.4 C676.6,315.4 708.6,340.6 708.6,377.4 C708.6,407.8 687.8,431.4 653.4,439.8 C599,453.4 584.2,459.8 584.2,470.2 C584.2,478.2 593,482.6 606.2,482.6 C626.2,482.6 639.8,472.6 646.2,453.8 L701,474.6 C687,515.8 652.6,539.8 605.8,539.8 C553,539.8 521,508.6 521,457.8 L521,384.2 C521,372.2 511.8,365.8 499.8,369.8 L499.8,319 C507.8,316.6 515.8,315.4 523.8,315.4 C542.2,315.4 558.2,321.8 567.8,333.4 C582.6,322.2 606.2,315.4 630.2,315.4 Z M623.8,366.6 C606.6,366.6 591,372.2 580.6,381.8 L580.6,412.2 C619.4,395.4 649,399 649,381.4 C649,371.4 639.4,366.6 623.8,366.6 Z M469.8,320.2 L469.8,622.6 L409.8,622.6 L409.8,320.2 L469.8,320.2 Z M266.6,315.4 C321.8,315.4 344.6,337.4 344.6,391.8 L344.6,477.4 L379.8,477.4 L379.8,536.2 L344.6,536.2 L344.6,596.6 L284.6,596.6 L284.6,536.2 L241.8,536.2 L241.8,477.4 L284.6,477.4 L284.6,409 C284.6,381 276.6,375.4 265,375.4 L239.8,375.4 L239.8,317 C247.8,316.2 256.2,315.4 266.6,315.4 Z M206.8,320.6 L206.8,622.6 L146.4,622.6 L146.4,513 C128.4,530.6 108.4,539.8 83.6,539.8 C37.2,539.8 -2.84217094e-14,507 0,453.8 L0,320.6 L60,320.6 L60,437 C60,463.8 75.2,479.4 96.4,479.4 C114.4,479.4 136.4,468.2 146.4,436.6 L146.4,320.6 L206.8,320.6 Z" id="FutureHealthSplash"></path>
              </g>
            </g>
          </g>
        </svg>
      </section>

      <!-- section -->
      <section id="About">

        <!-- article -->
        <article <?php post_class(); ?>>
        
          <?php
            foreach ($content_blocks as $block ) {
              echo render_block( $block );
            }

          ?>

          <?php edit_post_link(); ?>

        </article>
        <!-- /article -->
      </section>

    <?php endwhile; ?>
    <?php endif; ?>

    <section id="Projects">
      <?php include 'components/ProjectMap/ProjectMap.php'; ?>
    </section>

    <section id="Researchers">
      <h2>Research Team</h2>

      <?php $query = new WP_Query(array('category_name' => 'researchers', 'orderby' => 'rand')); ?>

      <?php if ($query->have_posts()): while ($query->have_posts()) : $query->the_post(); ?>

        <?php include 'components/ResearcherCard/ResearcherCard.php'; ?>

      <?php endwhile; ?>

      <?php else: ?>

        <!-- article -->
        <article>

          <h2><?php _e( 'Sorry, there are no events to display.', 'html5blank' ); ?></h2>

        </article>
        <!-- /article -->

      <?php endif; ?>
    </section>
  </main>

<div id="preloadImages">

</div>

<?php get_footer(); ?>